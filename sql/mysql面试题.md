##  面试题

1. mysql原子性和持久性怎么保证
2. innodb和myisam区别
3. 索引分类
4. innodb的底层数据结构
5. 为什么底层使用B+树不用B树


#### MYSQL是如何保证一致性、原子性和持久性
###### 1、mysql如何保证一致性
    从数据库层面，数据库是通过原子性、隔离性、持久性来保证一致性。也就是说ACID四大特性中，C（一致性）是目的，A（原子性），I（隔离性）,D(持久性)是手段，是为了保证一致性，数据库提供手段，数据库必须实现AID三大特性。
###### 2、mysql如何保证原子性
    是利用innodb的undo log
    undo log 名为回滚日志，是实现原子性的关键，当事务回滚时能撤销所有已经成功的sql语句，他需要记录你要回滚的相应日志信息。
    例如：
    当你delete 一条数据的时候，就需要记录这条数据的信息，回滚的时候就insert这条旧数据
    
    undo log 记录了这些需要回滚的信息，当事务执行失败或调用了rollback，导致事务需要回滚，便可以利用undo log中的信息将数据回滚到修改之前的样子。
    
###### 3、Mysql怎么保证持久性
    是利用innodb redo log
    正如之前所说，mysql是先把磁盘上的数据加载到内存中，在内存中对数据进行修改，在刷回磁盘，如果此时突然宕机，内存中的数据就会丢失。
    
    怎么解决这个问题？
    事务提交前把数据写入磁盘。
    只修改一个页面历得一个字节，就要将整个页面刷入磁盘，太浪费资源，毕竟一个页面16kb大小，你只修改其中一点点东西，就要将16kb内容刷入磁盘，不是很合理。
    毕竟一个事务里的sql可能牵涉多个数据也的修改，而这些数据页又不是相邻的，也就是数据随机IO。显然操作随机IO速度会比较慢。
    于是决定采用redo log 解决上述问题，当做数据修改的时候，不仅在内存中操作，还会咋iredo log 中记录这次操作，当事务提交的时候，会将redo log 日进进行刷回磁盘（redo log 一部分在磁盘上，一部分在内存中）当数据宕机的时候，会将redo log 中的内容恢复到数据库中，再根undo log 和bin log内容决定回滚数据还是提交数据。
 
 
 ### 4、 innodb和myisam的区别
   ###### 1、 myisam是不支持事务，innodb支持事务
   ###### 2、myisam 不支持外建 ；innodb支持外建
   ###### 3、myisam支持表级锁（不支持高并发，以读为主）；innodb支持行级锁（共享锁、排他锁、意向锁），粒度更小，但是执行不能确定扫描的范围的sql语句时，innodb同样会锁全表
    
   ###### 4、执行大量的select，myisam是最好的选择，执行大量的update和insert最好用innodb
   
  ###### 5、myisam在磁盘上有三个文件 .frm（存储表定义） .myd（存储表数据） .myi（存储表索引）;innodb磁盘上存储的是表空间数据文件和日志文件，innodb表小大只受限操作系统的大小
  
  ###### 6、myisam使用的是非聚集索引 ，索引和数据分开，只缓存索引；innnodb 使用聚集索引，索引和数据存储在同一个文件


### MYSQL的复制原理以及流程
	基本原理流程，3个线程之间的关联
	1、binlog线程-- -记录了所有改变数据库数据的语句，放进master的binlog种；
	2、io线程---使用start slave 之后，复制从master 上拉去binlog的内容，放进自己的relay log
	3、sql执行线程 --- 执行relay log 中的语句

### MYSQl种myisam 于innodb的区别
	1、innodb 支持事务，而myisam不支持
	2、innodb支持行级锁 ，而MyISAM支持表级锁
	3、innodb支持MVCC，而MYISAM不支持
	4、Innodb支持外建，而Myisam不支持
	5、innodb不支持全文索引，而MyISAM支持。

### innodb引擎四大特性
	1、插入缓冲 insert buffer
	2、二次写 double write
	3、自适应哈希索引
	4、预读

### MYSQL种varchar 与char的区别以及varchar(50)种50 代表的涵义

##### 1、varchar与char的区别
	char是一种固定长度的类型，varchar则是一种可变长度的类型
##### 2、varchar(25）中50的含义
	最多存放50个字符，varchar(50)和（200）存储hello所占空间一样，但后置再排序时会消耗更多内存，因为 order by col采用 fixed_length中计算col的长度

##### 3、int（20） 中20的含义
	是指显示字符的长度
	20表示最大显示宽度为20，担任占4字节，存储范围不变。

#### innodb的事务与 日志的实现方式
##### 有多少中日志
	1、错误日志：记录出错信息，也记录一些警告信息或者正确信息。
	2、查询日志：记录所有对数据库请求信息，不论这些请求是否得到了正确的执行
	3、慢查询日志：设置一个阈值，将运行时间超过该值的所有sql语句都记录到慢查询的日志文件中
	3、二进制日志：记录对数据课执行更改的所有操作（master中的binlog？）
	4、中继日志
	5、事务日志：

##### 事务的四种隔离级别
	读未提交
	读已提交
	可重复读
	串行

##### 事务是如如何通过日志来实现的，说的月深入越好
	事务日志是通过redo 和innodb的存储引擎日志缓冲来实现的，当开始一个事务的时候，会记录改事务的ISN（log sequence number）号当事务执行时，会往innodb存储引擎的日志缓存插入事务日志，当事务提交时，必须将存储引擎的日志缓冲区写入磁盘（通过innodb_flush_log_at_trx_commit来控制），也就是写入数据前，需要先写日志。这种方式称为“预写日志方式”






























































































































	





###### 7、myisam 保存表具体行数；innodb不保存